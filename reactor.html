<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>3D –ú–æ–¥–µ–ª—å —Ä–µ–∞–∫—Ç–æ—Ä–∞</title>
    <link rel="stylesheet" href="css/reactor-styles.css">

    <!-- model-viewer (module) -->
    <script type="module" src="https://unpkg.com/@google/model-viewer@1.13.4/dist/model-viewer.min.js"></script>
    <!-- three.js + loaders -->
    <script src="https://unpkg.com/three@0.164.0/build/three.min.js"></script>
    <script src="https://unpkg.com/three@0.164.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://unpkg.com/three@0.164.0/examples/js/loaders/GLTFLoader.js"></script>

    <style>
      /* –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —É—Ç–æ—á–Ω–µ–Ω–∏—è (–Ω–µ —Ç—Ä–æ–≥–∞—é—Ç –≤–∞—à –æ—Å–Ω–æ–≤–Ω–æ–π CSS) */
      .viewer-toggle { display:flex; gap:10px; margin-top:12px; }
      .viewer-toggle .btn { padding:8px 12px; border-radius:6px; border:1px solid #ccc; background:#fff; cursor:pointer; text-decoration:none; color:inherit; }
      .viewer-toggle .btn.active { background:#007bff; color:#fff; border-color:#007bff; }
      /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ three.js */
      #threejs-container { width:100%; height:500px; border-radius:8px; overflow:hidden; background:transparent; display:none; }
      /* –ü–æ–¥–¥–µ—Ä–∂–∫–∞ model-viewer - –¥–µ–ª–∞–µ–º –µ–≥–æ –±–ª–æ–∫–æ–º –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
      model-viewer { display:block; width:100%; height:500px; border-radius:8px; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>3D –ú–æ–¥–µ–ª—å —Ä–µ–∞–∫—Ç–æ—Ä–∞</h1>
            <p class="subtitle">–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π 3D-–ø—Ä–æ—Å–º–æ—Ç—Ä</p>
        </header>

        <div class="buttons-container" style="margin-top:1.5rem;">
            <a class="nav-button" href="index.html" target="_self" rel="noopener">–í–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –≥–ª–∞–≤–Ω—É—é</a>
            <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ -->
            <div class="viewer-toggle" style="margin-left:12px; display:inline-flex; vertical-align:middle;">
                <button id="btn-modelviewer" class="btn active" type="button">Model-Viewer</button>
                <button id="btn-threejs" class="btn" type="button">Three.js</button>
            </div>
        </div>

        <main class="media" style="grid-template-columns: 1fr; margin-top:16px;">
            <section class="card" aria-label="3D –º–æ–¥–µ–ª—å —Ä–µ–∞–∫—Ç–æ—Ä–∞">
                <strong>–ú–æ–¥–µ–ª—å —Ä–µ–∞–∫—Ç–æ—Ä–∞ –ë–†–ï–°–¢-–û–î-300</strong>

                <!-- model-viewer (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑–∞–Ω) -->
                <div id="modelviewer-wrapper">
                  <model-viewer 
                    id="mv"
                    src="assets/–ù–æ–≤–∞—è –ø–∞–ø–∫–∞/scene.gltf" 
                    alt="3D –º–æ–¥–µ–ª—å —è–¥–µ—Ä–Ω–æ–≥–æ —Ä–µ–∞–∫—Ç–æ—Ä–∞"
                    auto-rotate
                    camera-controls
                    shadow-intensity="1"
                    exposure="1"
                    ar
                    ></model-viewer>
                </div>

                <!-- three.js canvas –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—Å–∫—Ä—ã—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) -->
                <div id="threejs-container" aria-hidden="true"></div>

                <div class="note" id="viewer-note">–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º—ã—à—å (–∏–ª–∏ –ø–∞–ª–µ—Ü –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ) –¥–ª—è –≤—Ä–∞—â–µ–Ω–∏—è –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏.</div>
                <div class="note" id="status" style="margin-top:8px; font-size:0.9em; color:#444;">–°—Ç–∞—Ç—É—Å: –æ–∂–∏–¥–∞—é –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏...</div>
            </section>
        </main>

        <footer>
            <div class="footer-content">
                <div class="footer-section">
                    <h3>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h3>
                    <ul>
                        <li>‚úâÔ∏è Email: <a href="mailto:info@gmail.com">info@gmail.com</a></li>
                        <li>üìû –¢–µ–ª–µ—Ñ–æ–Ω: <a href="tel:+70000000000">8 (000) 000-00-00</a></li>
                        <li>üìç –ê–¥—Ä–µ—Å: –≥. –ö–µ–º–µ—Ä–æ–≤, —É–ª. –í–µ—Å–µ–Ω–Ω—è, 28</li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>–û –ø—Ä–æ–µ–∫—Ç–µ</h3>
                    <ul>
                        <li><a href="about.html">–û –ø—Ä–æ–µ–∫—Ç–µ</a></li>
                        <li><a href="research.html">–ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>–ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏</h3>
                    <ul>
                        <li><a href="index.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                        <li><a href="technology.html">–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</a></li>
                    </ul>
                </div>
            </div>

            <div class="copyright">
                <p>¬© 2025 –ü—Ä–æ–µ–∫—Ç "–ü—Ä–æ—Ä—ã–≤". –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
            </div>
        </footer>
    </div>

    <script>
      // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –º–µ–∂–¥—É model-viewer –∏ three.js
      const btnMV = document.getElementById('btn-modelviewer');
      const btnThree = document.getElementById('btn-threejs');
      const mvWrapper = document.getElementById('modelviewer-wrapper');
      const threeWrapper = document.getElementById('threejs-container');
      const statusEl = document.getElementById('status');

      btnMV.addEventListener('click', () => {
        btnMV.classList.add('active'); btnThree.classList.remove('active');
        mvWrapper.style.display = ''; threeWrapper.style.display = 'none';
        threeWrapper.setAttribute('aria-hidden', 'true');
        statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –ø–æ–∫–∞–∑–∞–Ω model-viewer.';
      });

      btnThree.addEventListener('click', () => {
        btnThree.classList.add('active'); btnMV.classList.remove('active');
        mvWrapper.style.display = 'none'; threeWrapper.style.display = '';
        threeWrapper.setAttribute('aria-hidden', 'false');
        statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è three.js...';
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º three.js –æ–¥–∏–Ω —Ä–∞–∑ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏
        if (!window._threeInitialized) initThreeJS();
      });

      /* ========== Three.js viewer ========== */
      function initThreeJS() {
        window._threeInitialized = true;
        const container = document.getElementById('threejs-container');
        // –°—Ü–µ–Ω–∞ –∏ –∫–∞–º–µ—Ä–∞
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(45, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(0, 1.5, 4);

        // –†–µ–Ω–¥–µ—Ä–µ—Ä
        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio || 1);
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setClearColor(0x000000, 0); // –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π —Ñ–æ–Ω
        container.appendChild(renderer.domElement);

        // –ö–æ–Ω—Ç—Ä–æ–ª—ã
        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.07;

        // –°–≤–µ—Ç
        const ambient = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambient);
        const pLight = new THREE.PointLight(0xffffff, 1);
        pLight.position.set(2, 3, 2);
        scene.add(pLight);
        // helper (–º–æ–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å)
        const helper = new THREE.PointLightHelper(pLight, 0.2);
        scene.add(helper);

        // GLTFLoader
        const loader = new THREE.GLTFLoader();
        const MODEL_PATH = 'assets/–ù–æ–≤–∞—è –ø–∞–ø–∫–∞/scene.gltf';
        let model = null;

        loader.load(
          MODEL_PATH,
          function(gltf) {
            model = gltf.scene;
            scene.add(model);

            // –¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –ø–æ–¥–≥–æ–Ω–∫–∞ –∫–∞–º–µ—Ä—ã
            const box = new THREE.Box3().setFromObject(model);
            const size = box.getSize(new THREE.Vector3());
            const center = box.getCenter(new THREE.Vector3());
            model.position.sub(center);

            const maxDim = Math.max(size.x, size.y, size.z);
            const fitDistance = maxDim * 1.8;
            camera.position.set(0, maxDim * 0.6, fitDistance);
            camera.lookAt(new THREE.Vector3(0, 0, 0));
            controls.target.set(0, 0, 0);
            controls.update();

            statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ three.js.';
          },
          function(xhr) {
            if (xhr.lengthComputable) {
              const percent = Math.round((xhr.loaded / xhr.total) * 100);
              statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏ ‚Äî ' + percent + '%';
            } else {
              statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –∑–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–∏‚Ä¶';
            }
          },
          function(err) {
            console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏ (three.js):', err);
            statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏ (—Å–º. –∫–æ–Ω—Å–æ–ª—å).';
            statusEl.style.color = '#b00020';
          }
        );

        // –ê–Ω–∏–º–∞—Ü–∏—è
        function animate() {
          requestAnimationFrame(animate);
          if (model) model.rotation.y += 0.005;
          controls.update();
          renderer.render(scene, camera);
        }
        animate();

        // –†–µ—Å–∞–π–∑
        window.addEventListener('resize', () => {
          const w = container.clientWidth;
          const h = container.clientHeight;
          camera.aspect = w / h;
          camera.updateProjectionMatrix();
          renderer.setSize(w, h);
        });

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ WebGL
        if (!renderer.capabilities.isWebGL2 && !window.WebGLRenderingContext) {
          statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –≤–∞—à –±—Ä–∞—É–∑–µ—Ä/—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç WebGL.';
          statusEl.style.color = '#b00020';
        }
      }

      /* ========== –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ model-viewer ========== */
      const mvEl = document.getElementById('mv');
      mvEl.addEventListener('load', () => {
        statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –≤ model-viewer.';
        statusEl.style.color = '#222';
      });
      mvEl.addEventListener('error', (e) => {
        console.error('model-viewer error', e);
        statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –æ—à–∏–±–∫–∞ model-viewer (—Å–º. –∫–æ–Ω—Å–æ–ª—å).';
        statusEl.style.color = '#b00020';
      });

      // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ñ–∞–π–ª–∞ (—á–µ—Ä–µ–∑ fetch) ‚Äî –ø–æ–ª–µ–∑–Ω–∞—è –±—ã—Å—Ç—Ä–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ CORS)
      (function checkModelExists() {
        fetch('assets/reactor.glb', { method: 'HEAD' })
          .then(resp => {
            if (!resp.ok) {
              statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –º–æ–¥–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ (HTTP ' + resp.status + '). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å assets/reactor.glb';
              statusEl.style.color = '#b00020';
            } else {
              // –Ω–∏—á–µ–≥–æ –º–µ–Ω—è—Ç—å –Ω–µ –Ω—É–∂–Ω–æ
            }
          })
          .catch(err => {
            // fetch –º–æ–∂–µ—Ç –ø—Ä–æ–≤–∞–ª–∏—Ç—å—Å—è –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ file:// ‚Äî –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–∞–µ–º
            statusEl.textContent = '–°—Ç–∞—Ç—É—Å: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—É —á–µ—Ä–µ–∑ HTTP (–ª–æ–∫–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä), –∞ –Ω–µ file://';
            statusEl.style.color = '#b00020';
            console.warn('–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ failed:', err);
          });
      })();
    </script>
</body>
</html>
